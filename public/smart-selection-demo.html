<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½é—œè¯é¸æ“‡ - æ¼”ç¤º</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <style>
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .demo-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
        }
        
        .demo-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .feature-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .feature-card h3 {
            color: #ff6d5a;
            margin-bottom: 10px;
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 5px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .feature-list li::before {
            content: "âœ“";
            color: #4caf50;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1><i class="fas fa-magic"></i> æ™ºèƒ½é—œè¯é¸æ“‡åŠŸèƒ½æ¼”ç¤º</h1>
            <p>é«”é©—å¢å¼·çš„ workflow å’Œ credential æ™ºèƒ½é—œè¯é¸æ“‡åŠŸèƒ½</p>
        </div>

        <div class="demo-features">
            <div class="feature-card">
                <h3><i class="fas fa-link"></i> æ™ºèƒ½é—œè¯</h3>
                <ul class="feature-list">
                    <li>å‹¾é¸ workflow è‡ªå‹•é¸ä¸­ç›¸é—œæ†‘è­‰</li>
                    <li>å–æ¶ˆå‹¾é¸æ™‚æ™ºèƒ½åˆ¤æ–·æ˜¯å¦ä¿ç•™æ†‘è­‰</li>
                    <li>è¦–è¦ºåŒ–é¡¯ç¤ºé—œè¯é—œä¿‚</li>
                    <li>å‹•ç•«æ•ˆæœæå‡ç”¨æˆ¶é«”é©—</li>
                </ul>
            </div>

            <div class="feature-card">
                <h3><i class="fas fa-eye"></i> è¦–è¦ºæç¤º</h3>
                <ul class="feature-list">
                    <li>æ»‘é¼ æ‡¸åœé«˜äº®ç›¸é—œæ†‘è­‰</li>
                    <li>è‡ªå‹•é¸ä¸­é …ç›®ç‰¹æ®Šæ¨™è¨˜</li>
                    <li>é—œè¯æ•¸é‡æŒ‡ç¤ºå™¨</li>
                    <li>é¸æ“‡ç‹€æ…‹å¯¦æ™‚æ‘˜è¦</li>
                </ul>
            </div>

            <div class="feature-card">
                <h3><i class="fas fa-cog"></i> éˆæ´»æ§åˆ¶</h3>
                <ul class="feature-list">
                    <li>å¯åˆ‡æ›æ™ºèƒ½é—œè¯é–‹é—œ</li>
                    <li>æ”¯æ´éµç›¤å¿«æ·éµæ“ä½œ</li>
                    <li>å…¨é¸/å–æ¶ˆå…¨é¸åŠŸèƒ½</li>
                    <li>é¸æ“‡è¨ˆæ•¸å¯¦æ™‚æ›´æ–°</li>
                </ul>
            </div>

            <div class="feature-card">
                <h3><i class="fas fa-keyboard"></i> å¿«æ·éµ</h3>
                <ul class="feature-list">
                    <li>Ctrl+S: åˆ‡æ›æ™ºèƒ½é—œè¯</li>
                    <li>Shift+Ctrl+A: å…¨é¸ workflows</li>
                    <li>Ctrl+D: æ¸…é™¤æ‰€æœ‰é¸æ“‡</li>
                    <li>æå‡æ“ä½œæ•ˆç‡</li>
                </ul>
            </div>
        </div>

        <div class="backup-container">
            <div class="backup-settings">
                <div class="form-group">
                    <label for="backupName">å‚™ä»½åç¨±</label>
                    <input type="text" id="backupName" placeholder="æ™ºèƒ½é—œè¯æ¼”ç¤ºå‚™ä»½">
                </div>
                <div class="form-group">
                    <label for="backupDestination">å‚™ä»½ç›®æ¨™</label>
                    <select id="backupDestination">
                        <option value="github">GitHub</option>
                        <option value="googledrive">Google Drive</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="smart-toggle-label">
                        <input type="checkbox" id="smartSelectionToggle" checked>
                        <span class="toggle-slider"></span>
                        æ™ºèƒ½é—œè¯é¸æ“‡
                    </label>
                    <small class="form-help">
                        è‡ªå‹•é¸ä¸­ workflow ç›¸é—œçš„æ†‘è­‰
                        <br>
                        <span class="keyboard-shortcuts">
                            å¿«æ·éµ: Ctrl+S åˆ‡æ› | Shift+Ctrl+A å…¨é¸ | Ctrl+D æ¸…é™¤
                        </span>
                    </small>
                </div>
            </div>

            <div class="items-selection">
                <div class="selection-section">
                    <div class="section-header">
                        <h3>
                            <i class="fas fa-project-diagram"></i>
                            Workflows
                            <span class="item-count" id="workflowCount">3</span>
                        </h3>
                        <div class="selection-controls">
                            <button class="btn btn-sm" id="selectAllWorkflows">å…¨é¸</button>
                            <button class="btn btn-sm" id="deselectAllWorkflows">å–æ¶ˆå…¨é¸</button>
                        </div>
                    </div>
                    <div class="items-list" id="workflowsList">
                        <!-- æ¼”ç¤ºæ•¸æ“š -->
                        <div class="item-checkbox workflow-item" id="workflow-item-1"
                             onmouseenter="highlightRelatedCredentials('1', true)"
                             onmouseleave="highlightRelatedCredentials('1', false)">
                            <input type="checkbox" id="workflow-1" value="1" data-type="workflow"
                                   data-related-credentials="1,2"
                                   onchange="handleWorkflowSelection(this)">
                            <div class="item-info">
                                <div class="item-name">
                                    ç”¨æˆ¶è¨»å†Šæµç¨‹
                                    <span class="related-indicator" title="æ­¤ workflow ä½¿ç”¨äº† 2 å€‹æ†‘è­‰">ğŸ”—2</span>
                                </div>
                                <div class="item-details">
                                    <span class="item-status status-active">
                                        <i class="fas fa-play"></i>
                                        å•Ÿç”¨
                                    </span>
                                    <span class="item-tag">ç”¨æˆ¶ç®¡ç†</span>
                                    <span class="related-credentials-info">ç›¸é—œæ†‘è­‰: 2</span>
                                </div>
                            </div>
                        </div>

                        <div class="item-checkbox workflow-item" id="workflow-item-2"
                             onmouseenter="highlightRelatedCredentials('2', true)"
                             onmouseleave="highlightRelatedCredentials('2', false)">
                            <input type="checkbox" id="workflow-2" value="2" data-type="workflow"
                                   data-related-credentials="2,3"
                                   onchange="handleWorkflowSelection(this)">
                            <div class="item-info">
                                <div class="item-name">
                                    éƒµä»¶é€šçŸ¥ç³»çµ±
                                    <span class="related-indicator" title="æ­¤ workflow ä½¿ç”¨äº† 2 å€‹æ†‘è­‰">ğŸ”—2</span>
                                </div>
                                <div class="item-details">
                                    <span class="item-status status-active">
                                        <i class="fas fa-play"></i>
                                        å•Ÿç”¨
                                    </span>
                                    <span class="item-tag">é€šçŸ¥</span>
                                    <span class="related-credentials-info">ç›¸é—œæ†‘è­‰: 2</span>
                                </div>
                            </div>
                        </div>

                        <div class="item-checkbox workflow-item" id="workflow-item-3"
                             onmouseenter="highlightRelatedCredentials('3', true)"
                             onmouseleave="highlightRelatedCredentials('3', false)">
                            <input type="checkbox" id="workflow-3" value="3" data-type="workflow"
                                   data-related-credentials="1"
                                   onchange="handleWorkflowSelection(this)">
                            <div class="item-info">
                                <div class="item-name">
                                    æ•¸æ“šåŒæ­¥ä»»å‹™
                                    <span class="related-indicator" title="æ­¤ workflow ä½¿ç”¨äº† 1 å€‹æ†‘è­‰">ğŸ”—1</span>
                                </div>
                                <div class="item-details">
                                    <span class="item-status status-inactive">
                                        <i class="fas fa-pause"></i>
                                        åœç”¨
                                    </span>
                                    <span class="item-tag">æ•¸æ“šè™•ç†</span>
                                    <span class="related-credentials-info">ç›¸é—œæ†‘è­‰: 1</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="selection-section">
                    <div class="section-header">
                        <h3>
                            <i class="fas fa-key"></i>
                            Credentials
                            <span class="item-count" id="credentialCount">3</span>
                        </h3>
                        <div class="selection-controls">
                            <button class="btn btn-sm" id="selectAllCredentials">å…¨é¸</button>
                            <button class="btn btn-sm" id="deselectAllCredentials">å–æ¶ˆå…¨é¸</button>
                        </div>
                    </div>
                    <div class="items-list" id="credentialsList">
                        <!-- æ¼”ç¤ºæ•¸æ“š -->
                        <div class="item-checkbox" id="credential-item-1">
                            <input type="checkbox" id="credential-1" value="1" data-type="credential">
                            <div class="item-info">
                                <div class="item-name">è³‡æ–™åº«é€£æ¥</div>
                                <div class="item-details">
                                    <span>é¡å‹: MySQL</span>
                                </div>
                            </div>
                        </div>

                        <div class="item-checkbox" id="credential-item-2">
                            <input type="checkbox" id="credential-2" value="2" data-type="credential">
                            <div class="item-info">
                                <div class="item-name">SMTP éƒµä»¶æœå‹™</div>
                                <div class="item-details">
                                    <span>é¡å‹: SMTP</span>
                                </div>
                            </div>
                        </div>

                        <div class="item-checkbox" id="credential-item-3">
                            <input type="checkbox" id="credential-3" value="3" data-type="credential">
                            <div class="item-info">
                                <div class="item-name">API é‡‘é‘°</div>
                                <div class="item-details">
                                    <span>é¡å‹: HTTP Header Auth</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ™ºèƒ½é¸æ“‡æ‘˜è¦ -->
            <div class="selection-summary" id="selectionSummary" style="display: none;">
                <div class="summary-header">
                    <h4><i class="fas fa-magic"></i> æ™ºèƒ½é¸æ“‡æ‘˜è¦</h4>
                </div>
                <div class="summary-content">
                    <div class="summary-item">
                        <span class="summary-label">å·²é¸ Workflows:</span>
                        <span class="summary-value" id="selectedWorkflowsCount">0</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">å·²é¸ Credentials:</span>
                        <span class="summary-value" id="selectedCredentialsCount">0</span>
                        <span class="auto-selected-count" id="autoSelectedCount">(0 å€‹è‡ªå‹•é¸ä¸­)</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">ç¸½è¨ˆ:</span>
                        <span class="summary-value total" id="totalSelectedCount">0</span>
                    </div>
                </div>
            </div>

            <div class="backup-actions">
                <button id="startBackupBtn" class="btn btn-primary btn-large" disabled>
                    <i class="fas fa-upload"></i>
                    é–‹å§‹å‚™ä»½
                </button>
            </div>
        </div>

        <!-- é€šçŸ¥å®¹å™¨ -->
        <div id="notifications" class="notifications"></div>
    </div>

    <script>
        // æ¨¡æ“¬æ•¸æ“š
        let workflows = [
            { id: '1', name: 'ç”¨æˆ¶è¨»å†Šæµç¨‹', active: true, tags: ['ç”¨æˆ¶ç®¡ç†'], relatedCredentialIds: ['1', '2'] },
            { id: '2', name: 'éƒµä»¶é€šçŸ¥ç³»çµ±', active: true, tags: ['é€šçŸ¥'], relatedCredentialIds: ['2', '3'] },
            { id: '3', name: 'æ•¸æ“šåŒæ­¥ä»»å‹™', active: false, tags: ['æ•¸æ“šè™•ç†'], relatedCredentialIds: ['1'] }
        ];

        let credentials = [
            { id: '1', name: 'è³‡æ–™åº«é€£æ¥', type: 'MySQL' },
            { id: '2', name: 'SMTP éƒµä»¶æœå‹™', type: 'SMTP' },
            { id: '3', name: 'API é‡‘é‘°', type: 'HTTP Header Auth' }
        ];

        // è¤‡è£½ä¸»æ‡‰ç”¨çš„æ™ºèƒ½é—œè¯åŠŸèƒ½
        function handleWorkflowSelection(workflowCheckbox) {
            const isChecked = workflowCheckbox.checked;
            const relatedCredentialIds = workflowCheckbox.dataset.relatedCredentials;
            
            const smartToggle = document.getElementById('smartSelectionToggle');
            const smartSelectionEnabled = smartToggle ? smartToggle.checked : true;
            
            if (!relatedCredentialIds || !smartSelectionEnabled) {
                updateSelectionCounts();
                return;
            }

            const credentialIds = relatedCredentialIds.split(',').filter(id => id.trim());
            
            credentialIds.forEach(credentialId => {
                const credentialCheckbox = document.getElementById(`credential-${credentialId}`);
                const credentialItem = document.getElementById(`credential-item-${credentialId}`);
                
                if (!credentialCheckbox) return;

                if (isChecked) {
                    credentialCheckbox.checked = true;
                    if (credentialItem) {
                        credentialItem.classList.add('auto-selected');
                        credentialItem.style.animation = 'highlightAutoSelect 0.5s ease';
                        setTimeout(() => {
                            credentialItem.style.animation = '';
                        }, 500);
                    }
                } else {
                    const stillNeeded = isCredentialStillNeeded(credentialId);
                    if (!stillNeeded) {
                        credentialCheckbox.checked = false;
                        if (credentialItem) {
                            credentialItem.classList.remove('auto-selected');
                            credentialItem.style.animation = 'highlightAutoDeselect 0.5s ease';
                            setTimeout(() => {
                                credentialItem.style.animation = '';
                            }, 500);
                        }
                    }
                }
            });
            
            if (credentialIds.length > 0) {
                const action = isChecked ? 'é¸ä¸­' : 'å–æ¶ˆé¸ä¸­';
                showSmartSelectionNotification(`å·²è‡ªå‹•${action}ç›¸é—œæ†‘è­‰`, 'info');
            }
            
            updateSelectionCounts();
        }

        function isCredentialStillNeeded(credentialId) {
            const selectedWorkflows = document.querySelectorAll('input[data-type="workflow"]:checked');
            for (const wf of selectedWorkflows) {
                const ids = (wf.dataset.relatedCredentials || '').split(',');
                if (ids.includes(credentialId)) return true;
            }
            return false;
        }

        function highlightRelatedCredentials(workflowId, highlight) {
            const workflowCheckbox = document.getElementById(`workflow-${workflowId}`);
            if (!workflowCheckbox) return;
            
            const relatedCredentialIds = workflowCheckbox.dataset.relatedCredentials;
            if (!relatedCredentialIds) return;
            
            const credentialIds = relatedCredentialIds.split(',').filter(id => id.trim());
            
            credentialIds.forEach(credentialId => {
                const credentialItem = document.getElementById(`credential-item-${credentialId}`);
                if (credentialItem) {
                    if (highlight) {
                        credentialItem.classList.add('related-highlight');
                    } else {
                        credentialItem.classList.remove('related-highlight');
                    }
                }
            });
        }

        function updateSelectionCounts() {
            const selectedWorkflows = document.querySelectorAll('input[data-type="workflow"]:checked').length;
            const selectedCredentials = document.querySelectorAll('input[data-type="credential"]:checked').length;
            const autoSelectedCredentials = document.querySelectorAll('.item-checkbox.auto-selected input:checked').length;
            
            const summaryPanel = document.getElementById('selectionSummary');
            const selectedWorkflowsCountEl = document.getElementById('selectedWorkflowsCount');
            const selectedCredentialsCountEl = document.getElementById('selectedCredentialsCount');
            const autoSelectedCountEl = document.getElementById('autoSelectedCount');
            const totalSelectedCountEl = document.getElementById('totalSelectedCount');
            
            if (summaryPanel && selectedWorkflowsCountEl && selectedCredentialsCountEl && autoSelectedCountEl && totalSelectedCountEl) {
                const totalSelected = selectedWorkflows + selectedCredentials;
                
                if (totalSelected > 0) {
                    summaryPanel.style.display = 'block';
                    selectedWorkflowsCountEl.textContent = selectedWorkflows;
                    selectedCredentialsCountEl.textContent = selectedCredentials;
                    autoSelectedCountEl.textContent = `(${autoSelectedCredentials} å€‹è‡ªå‹•é¸ä¸­)`;
                    totalSelectedCountEl.textContent = totalSelected;
                } else {
                    summaryPanel.style.display = 'none';
                }
            }
            
            const backupBtn = document.getElementById('startBackupBtn');
            if (backupBtn) {
                const totalSelected = selectedWorkflows + selectedCredentials;
                if (totalSelected > 0) {
                    backupBtn.innerHTML = `<i class="fas fa-upload"></i> é–‹å§‹å‚™ä»½ (${selectedWorkflows} å€‹ Workflows, ${selectedCredentials} å€‹ Credentials)`;
                    backupBtn.disabled = false;
                    backupBtn.classList.add('ready');
                } else {
                    backupBtn.innerHTML = `<i class="fas fa-upload"></i> é–‹å§‹å‚™ä»½`;
                    backupBtn.disabled = true;
                    backupBtn.classList.remove('ready');
                }
            }
        }

        function selectAllWorkflows(select) {
            const checkboxes = document.querySelectorAll('input[data-type="workflow"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = select;
                handleWorkflowSelection(checkbox);
            });
        }

        function selectAllCredentials(select) {
            const checkboxes = document.querySelectorAll('input[data-type="credential"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = select;
                const credentialItem = document.getElementById(`credential-item-${checkbox.value}`);
                if (credentialItem && !select) {
                    credentialItem.classList.remove('auto-selected');
                }
            });
            updateSelectionCounts();
        }

        function handleSmartToggleChange() {
            const smartToggle = document.getElementById('smartSelectionToggle');
            const isEnabled = smartToggle.checked;
            
            if (!isEnabled) {
                document.querySelectorAll('.item-checkbox.auto-selected').forEach(item => {
                    item.classList.remove('auto-selected');
                });
                showSmartSelectionNotification('æ™ºèƒ½é—œè¯å·²é—œé–‰', 'info');
            } else {
                const selectedWorkflows = document.querySelectorAll('input[data-type="workflow"]:checked');
                selectedWorkflows.forEach(workflowCheckbox => {
                    handleWorkflowSelection(workflowCheckbox);
                });
                showSmartSelectionNotification('æ™ºèƒ½é—œè¯å·²é–‹å•Ÿ', 'info');
            }
            
            updateSelectionCounts();
        }

        function showSmartSelectionNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `smart-notification ${type}`;
            notification.textContent = message;
            
            const container = document.getElementById('notifications');
            if (container) {
                container.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.opacity = '0';
                    setTimeout(() => {
                        notification.remove();
                    }, 200);
                }, 1500);
            }
        }

        function handleKeyboardShortcuts(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                const smartToggle = document.getElementById('smartSelectionToggle');
                if (smartToggle) {
                    smartToggle.checked = !smartToggle.checked;
                    handleSmartToggleChange();
                }
            }
            
            if ((e.ctrlKey || e.metaKey) && e.key === 'a' && e.shiftKey) {
                e.preventDefault();
                selectAllWorkflows(true);
            }
            
            if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
                e.preventDefault();
                selectAllWorkflows(false);
                selectAllCredentials(false);
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // è¨­ç½®äº‹ä»¶ç›£è½å™¨
            document.getElementById('selectAllWorkflows').addEventListener('click', () => selectAllWorkflows(true));
            document.getElementById('deselectAllWorkflows').addEventListener('click', () => selectAllWorkflows(false));
            document.getElementById('selectAllCredentials').addEventListener('click', () => selectAllCredentials(true));
            document.getElementById('deselectAllCredentials').addEventListener('click', () => selectAllCredentials(false));
            document.getElementById('smartSelectionToggle').addEventListener('change', handleSmartToggleChange);
            document.addEventListener('keydown', handleKeyboardShortcuts);
            
            // åˆå§‹åŒ–è¨ˆæ•¸
            updateSelectionCounts();
        });
    </script>
</body>
</html>